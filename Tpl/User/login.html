<include file="./Tpl/Public/headstart.html" />
<title>头脑风暴鸡</title>
<link rel="stylesheet" href="__PUBLIC__/css/common.css" />
<link rel="stylesheet" href="__PUBLIC__/css/panel.css" />
<style>
	header, #wrapper {
		margin: 0 auto;
		width: 800px;
	}
	
	.main div {
		margin-bottom: 5px;
	}
	
	strong {
		font-size: 15px;
		font-weight: normal;
	}
</style>
<script src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
<script src="__PUBLIC__/javascript/jqTools.js"></script>
<script src="__PUBLIC__/javascript/InputValidate.js"></script>
<script>
	var msg;
	
	$(function(){
		msg = $('#topSlideMsg');
	
		$('#email').focus();
		$('#email').blur(function(){
			if (this.value.length > 0) {
				if (validateEmail(this, msg[0], '请输入有效的邮箱', '')) {
					var inputEmail = this.value;				
					$.post(
						"__URL__/checkEmail",
						{email: inputEmail},
						checkEmailResponse,
						"json"
					);
				} else {
					$('.register').hide();
					$('#login').val('登录/注册').attr("disabled", "disabled");
					slideBox(msg, 2000, 'red');
				}
			}
		});
		
		$('#login').click(function(){			
			if (!validateEmail($('#email')[0], msg[0], '请输入有效的邮箱', '')
				|| !validateLength(6, 12, $('#password')[0], msg[0], '密码有效长度为6~12位', '')){
				slideBox(msg, 2000, 'red');
				refreshVerify();
				return false;
			}		

			var action = $('#login').val();			
			var mail = $('#email').val();
			var pwd = $('#password').val();
			if (action === '注册') {
				if (!validateNonEmpty($('#name')[0], msg[0], '昵称不能为空', '')
					|| !validateNonEmpty($('#verify')[0], msg[0], '验证码不能为空', '')){
					
					slideBox(msg, 2000, 'red');
					refreshVerify();
					return false;
				}				
				
				var userName = $('#name').val();
				var verifyCode = $('#verify').val();
				$.post(
					"__URL__/addUser",
					{
						email: mail,
						password: pwd,
						name: userName,
						verify: verifyCode
					},
					showResponse,
					"json"
				);
			} else if (action === '登录') {
				$.post(
					"__URL__/loginUser",
					{
						email: mail,
						password: pwd
					},
					showResponse,
					"json"
				);
			}
		});
	});
	
	function showResponse(data) {
		if (data.status === 0) {
			slideBox(msg.text(data.info), 2000, 'red');
			if (data.info === '邮箱或密码输入有误') {
				$('#forgotPassword').show();
			}
			refreshVerify();
		} else {
			<if condition="empty($token)">
				window.location = "__APP__";
			<else />
				window.location = "__APP__/PhaseOne/attend/token/{$token}";
			</if>			
		}
	}
	
	function checkEmailResponse(data) {	
		if (data.status === 0) {
			$('.register').show();
			$('#login').val('注册');
		} else {
			$('.register').hide();
			$('#login').val('登录');
		}
		$('#login').removeAttr("disabled");
	}
	
	function refreshVerify() {
		var timenow = new Date().getTime();
		document.getElementById("verifyImg").src="__URL__/showVerifyImage/" + timenow;
	}
</script>
</head>
<body>
	<header style="margin-top: 100px; height: 200px;">
	</header>
	<div id="wrapper">
		<div id="topSlideMsg"></div>		
		<div class="panel_wrapper">
			<div class="panelbody" style="float:left;">
				<div style="width:490px; height:187px;">fsafjsdalfjsdla</div>
			</div>
			<div class="panelbody" style="float:right;">
				<div class="main" style="height:142px;">
					<div>
						<strong>邮箱</strong>
						<input id="email" style="width: 200px;" class="text" type="text" tabindex="1">
					</div>
					<div>
						<strong>密码</strong>
						<input id="password" style="width: 200px;" class="text" type="password" tabindex="2"> 
					</div>
					<div class="hide register">
						<strong>昵称</strong>
						<input id="name" style="width: 200px;" class="text" type="text" tabindex="3">
					</div>
					<div class="hide register">
						<strong>验证</strong>
						<input id="verify" style="width: 143px;" class="text" type="text" tabindex="4">&nbsp;<img style="vertical-align:middle;" id="verifyImg" src="__URL__/showVerifyImage/" alt="Verify Image" >
					</div>
				</div>
				<div class="ctrl">
					<span>
						<input id="login" style="font-size:15px;" type="button" value="注册/登录" tabindex="5" class="btn" disabled="disabled">
					</span>
					<span>
						<input id="forgotPassword" style="font-size:15px;" type="button" value="找回密码" tabindex="6" class="btn hide">
					</span>
				</div>
			</div>
		</div>
		
	</div>
<include file="./Tpl/Public/footer_bodyend.html" />